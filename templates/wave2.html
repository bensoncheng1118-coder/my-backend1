<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>聲強與聲壓計算器與衰減器</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #4a90e2;
      --secondary-color: #34495e;
      --success-color: #2ecc71;
      --danger-color: #e74c3c;
      --bg-color: #f4f7f6;
      --card-bg: #ffffff;
      --text-color: #333;
      --text-muted: #7f8c8d;
      --radius-pill: 50px;
      --radius-md: 12px;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s ease;
    }

    body {
      font-family: 'Noto Sans TC', sans-serif;
      margin: 0;
      padding: 0;
      background-color: var(--bg-color);
      color: var(--text-color);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .container {
      width: 95%;
      max-width: 600px;
      margin: 60px auto;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
    }

    h1 {
      font-weight: 700;
      color: var(--secondary-color);
      margin-bottom: 10px;
      font-size: 1.8rem;
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow);
      padding: 35px;
      margin-bottom: 20px;
    }

    /* Tabs / Mode Switcher */
    .btn-group {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }

    .btn-tab {
      padding: 10px 20px;
      border: 2px solid transparent;
      border-radius: var(--radius-pill);
      background-color: #eee;
      color: var(--text-muted);
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      font-size: 0.95rem;
      flex: 1;
      min-width: 140px;
      text-align: center;
    }

    .btn-tab:hover {
      background-color: #e0e0e0;
    }

    .btn-tab.active {
      background-color: var(--primary-color);
      color: white;
      box-shadow: 0 4px 10px rgba(74, 144, 226, 0.3);
    }

    label {
      display: block;
      margin: 15px 0 8px;
      font-weight: 600;
      color: var(--secondary-color);
    }

    input[type="number"],
    select {
      width: 100%;
      padding: 12px 15px;
      font-size: 1rem;
      border: 1px solid #ddd;
      border-radius: var(--radius-md);
      box-sizing: border-box;
      transition: var(--transition);
      background: #f9f9f9;
    }

    input[type="number"]:focus,
    select:focus {
      border-color: var(--primary-color);
      background: #fff;
      outline: none;
      box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
    }

    .btn-main {
      width: 100%;
      margin-top: 25px;
      padding: 14px;
      font-size: 1.1rem;
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: var(--radius-pill);
      cursor: pointer;
      font-weight: 700;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .btn-main:hover {
      background-color: #357abd;
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(74, 144, 226, 0.3);
    }

    #result {
      margin-top: 30px;
      font-size: 1.1rem;
      background: #eef5fc;
      padding: 20px;
      border-radius: var(--radius-md);
      border-left: 5px solid var(--primary-color);
      min-height: 1.5em;
      color: var(--secondary-color);
      font-weight: 500;
      transition: var(--transition);
    }

    .input-section {
      display: none;
      animation: fadeIn 0.4s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Modal Styling */
    #instructionModal {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      width: 90%;
      max-width: 550px;
      max-height: 85vh;
      overflow-y: auto;
      transform: translate(-50%, -50%);
      background: white;
      border-radius: var(--radius-md);
      padding: 35px;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
      z-index: 1000;
    }

    #instructionModal h2 {
      margin-top: 0;
      color: var(--secondary-color);
      border-bottom: 2px solid #eee;
      padding-bottom: 10px;
    }

    #instructionModal pre {
      white-space: pre-wrap;
      font-family: 'Noto Sans TC', sans-serif;
      font-size: 0.95rem;
      line-height: 1.6;
      color: #444;
      background: #fcfcfc;
      padding: 15px;
      border-radius: 8px;
    }

    #modalOverlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(3px);
      z-index: 999;
    }

    .btn-close {
      margin-top: 20px;
      background-color: var(--danger-color);
      color: white;
      width: 100%;
      border: none;
      padding: 12px;
      border-radius: var(--radius-pill);
      font-weight: 700;
      cursor: pointer;
      transition: var(--transition);
    }

    .btn-close:hover {
      background-color: #c0392b;
    }

    #backBtn {
      position: absolute;
      top: 30px;
      left: 30px;
      text-decoration: none;
      color: var(--text-muted);
      font-weight: 600;
      background: #fff;
      padding: 8px 18px;
      border-radius: var(--radius-pill);
      box-shadow: var(--shadow);
      display: flex;
      align-items: center;
      gap: 8px;
      transition: var(--transition);
    }

    #backBtn:hover {
      color: var(--primary-color);
      transform: translateX(-5px);
    }

    @media (max-width: 480px) {
      .container {
        margin: 80px auto 20px;
      }

      .card {
        padding: 20px;
      }

      .btn-tab {
        padding: 8px 12px;
        font-size: 0.85rem;
      }
    }
  </style>
</head>

<body>

  <a href="/" id="backBtn"><i class="fa-solid fa-chevron-left"></i> 返回首頁</a>

  <div class="container">
    <div class="header">
      <h1>聲壓與聲強分析工具</h1>
    </div>

    <div class="card">
      <!-- Main Navigation -->
      <div class="btn-group">
        <button id="btnInstruction" class="btn-tab" type="button"><i class="fa-solid fa-book"></i> 計算方法</button>
        <button id="btnDbCalc" class="btn-tab" type="button"><i class="fa-solid fa-calculator"></i> 分貝計算</button>
        <button id="btnDecayCalc" class="btn-tab" type="button"><i class="fa-solid fa-chart-line"></i> 分貝變化</button>
      </div>

      <!-- Section: Db Calculator -->
      <div id="dbCalcSection" class="input-section">
        <label for="dbInputType">選擇輸入類型</label>
        <select id="dbInputType">
          <option value="intensity">聲強 (強度值 W/m²)</option>
          <option value="pressure">聲壓 (壓力值 Pa)</option>
        </select>

        <label for="dbInputValue">輸入聲壓或聲強值</label>
        <input type="number" id="dbInputValue" step="any" min="0" placeholder="請輸入正數" />

        <button id="dbCalculateBtn" class="btn-main" type="button">
          <i class="fa-solid fa-play"></i> 開始計算
        </button>
      </div>

      <!-- Section: Decay Calculator -->
      <div id="decayCalcSection" class="input-section">
        <label for="decayInputType">選擇分析類型</label>
        <select id="decayInputType">
          <option value="intensity">聲強 (Power / Intensity)</option>
          <option value="pressure">聲壓 (Pressure)</option>
        </select>

        <label for="decayDistance1">起點距離 1 (m)</label>
        <input type="number" id="decayDistance1" step="any" min="0.001" placeholder="距離 1" />

        <label for="decayDistance2">終點距離 2 (m)</label>
        <input type="number" id="decayDistance2" step="any" min="0.001" placeholder="距離 2" />

        <button id="decayCalculateBtn" class="btn-main" type="button">
          <i class="fa-solid fa-bolt"></i> 計算分貝差
        </button>
      </div>

      <!-- Result Display Area -->
      <div id="result">點擊上方按鈕開始計算...</div>
    </div>
  </div>

  <!-- Instruction Modal -->
  <div id="modalOverlay"></div>
  <div id="instructionModal" role="dialog" aria-modal="true">
    <h2>分貝考題計算方法</h2>
    <pre>
一、 分貝數值計算:
(一)先看給的是聲強(I)還是聲壓(p)?
1. 聲強: 10 * log(I1 / I0), (I0 = 10^-12 W/m²)
2. 聲壓: 20 * log(p1 / p0), (p0 = 20μPa)

二、 分貝數值變化計算 (反比平方律):
1. 聲強: I ∝ 1 / r² (平方成反比)
   分貝差 = 10 * log(I2 / I1) = 20 * log(r1 / r2)
2. 聲壓: p ∝ 1 / r (成反比)
   分貝差 = 20 * log(p2 / p1) = 20 * log(r1 / r2)

例題：
在距離聲源 10m 處聲音為 20dB，則距離 100m 處為幾分貝？
距離變為 10 倍，不論用聲強或聲壓計算，皆相差 -20dB。
計算：20 + (-20) = 0 dB。
    </pre>
    <button id="closeInstructionBtn" class="btn-close" type="button">確認並關閉</button>
  </div>

  <script>
    (() => {
      const refs = {
        btnInstruction: document.getElementById('btnInstruction'),
        btnDbCalc: document.getElementById('btnDbCalc'),
        btnDecayCalc: document.getElementById('btnDecayCalc'),
        dbCalcSection: document.getElementById('dbCalcSection'),
        decayCalcSection: document.getElementById('decayCalcSection'),
        resultEl: document.getElementById('result'),
        modalOverlay: document.getElementById('modalOverlay'),
        modal: document.getElementById('instructionModal'),
        btnCloseModal: document.getElementById('closeInstructionBtn'),
        // Inputs
        dbType: document.getElementById('dbInputType'),
        dbVal: document.getElementById('dbInputValue'),
        dbCalcBtn: document.getElementById('dbCalculateBtn'),
        decayType: document.getElementById('decayInputType'),
        d1: document.getElementById('decayDistance1'),
        d2: document.getElementById('decayDistance2'),
        decayCalcBtn: document.getElementById('decayCalculateBtn')
      };

      const I0 = 1e-12;
      const p0 = 20e-6;

      function resetActive() {
        [refs.btnDbCalc, refs.btnDecayCalc, refs.btnInstruction].forEach(b => b.classList.remove('active'));
      }

      function showSection(type) {
        resetActive();
        refs.dbCalcSection.style.display = type === 'db' ? 'block' : 'none';
        refs.decayCalcSection.style.display = type === 'decay' ? 'block' : 'none';

        if (type === 'db') refs.btnDbCalc.classList.add('active');
        if (type === 'decay') refs.btnDecayCalc.classList.add('active');

        refs.resultEl.textContent = '等待輸入...';
      }

      refs.btnDbCalc.onclick = () => showSection('db');
      refs.btnDecayCalc.onclick = () => showSection('decay');

      refs.btnInstruction.onclick = () => {
        refs.modal.style.display = 'block';
        refs.modalOverlay.style.display = 'block';
      };

      const hideModal = () => {
        refs.modal.style.display = 'none';
        refs.modalOverlay.style.display = 'none';
      };
      refs.btnCloseModal.onclick = hideModal;
      refs.modalOverlay.onclick = hideModal;

      // Logic for Db Calculation
      refs.dbCalcBtn.onclick = () => {
        const val = parseFloat(refs.dbVal.value);
        if (isNaN(val) || val <= 0) {
          refs.resultEl.textContent = '❌ 請輸入有效的正數';
          return;
        }

        let db = (refs.dbType.value === 'intensity')
          ? 10 * Math.log10(val / I0)
          : 20 * Math.log10(val / p0);

        refs.resultEl.innerHTML = `計算結果:<br><strong style="font-size:1.4rem; color:#4a90e2;">${db.toFixed(2)} dB</strong>`;
      };

      // Logic for Decay Calculation
      refs.decayCalcBtn.onclick = () => {
        const r1 = parseFloat(refs.d1.value);
        const r2 = parseFloat(refs.d2.value);

        if (isNaN(r1) || r1 <= 0 || isNaN(r2) || r2 <= 0) {
          refs.resultEl.textContent = '❌ 請輸入有效的距離數值';
          return;
        }

        // dB difference is always 20*log10(r1/r2) for both pressure and intensity-based distance changes 
        // because Intensity follows 1/r^2 (10*log(r1^2/r2^2) = 20*log(r1/r2))
        // and Pressure follows 1/r (20*log(r1/r2))
        const diff = 20 * Math.log10(r1 / r2);
        const sign = diff > 0 ? '增加' : (diff < 0 ? '減少' : '無變化');

        refs.resultEl.innerHTML = `分貝差值:<br><strong style="font-size:1.4rem; color:${diff >= 0 ? '#2ecc71' : '#e74c3c'};">${diff.toFixed(2)} dB</strong> (${sign})`;
      };

      // Inits
      showSection('db');

    })();
  </script>
</body>

</html>
